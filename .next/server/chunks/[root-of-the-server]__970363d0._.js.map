{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 60, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/onboarding/validators.ts"],"sourcesContent":["import { z } from \"zod\";\n\nexport const IntegrationProviderSchema = z.object({\n  provider: z.enum([\"google\", \"outlook\"]),\n  id: z.string(),\n  name: z.string(),\n});\n\nexport const ScheduleSchema = z.union([\n  z.object({\n    type: z.literal(\"fixed\"),\n    times: z.array(z.string()),\n  }),\n  z.object({\n    type: z.literal(\"interval\"),\n    hours: z.number(),\n  }),\n]);\n\nexport const SetupSchema = z.object({\n  version: z.literal(1),\n  progress: z.number().min(0).max(100),\n  steps: z.object({\n    accounts: z.boolean(),\n    people: z.boolean(),\n    documents: z.boolean(),\n    household: z.boolean(),\n    finance: z.boolean(),\n    health: z.boolean(),\n    automations: z.boolean(),\n    goals: z.boolean(),\n  }),\n  data: z.object({\n    integrations: z.object({\n      plaid: z.boolean().optional(),\n      calendars: z.array(IntegrationProviderSchema).optional(),\n      emailIngest: z.boolean().optional(),\n      drive: z.boolean().optional(),\n      health: z.array(z.enum([\"apple\", \"google\", \"fitbit\"])).optional(),\n    }),\n    contacts: z\n      .array(\n        z.object({\n          id: z.string(),\n          name: z.string(),\n          relation: z.enum([\"head\", \"family\", \"guest\", \"vendor\"]).default(\"family\"),\n          phone: z.string().optional(),\n          defaultChannel: z.enum([\"whatsapp\", \"sms\", \"none\"]).default(\"whatsapp\"),\n          notes: z.string().optional(),\n        })\n      )\n      .optional(),\n    docs: z\n      .array(\n        z.object({\n          id: z.string(),\n          filename: z.string(),\n          type: z.enum([\"id\", \"policy\", \"contract\", \"receipt\", \"medical\", \"other\"]),\n          expiresAt: z.string().nullable(),\n          tags: z.array(z.string()).optional(),\n        })\n      )\n      .optional(),\n    household: z\n      .object({\n        name: z.string(),\n        address: z.string().optional(),\n        utilities: z.array(z.enum([\"internet\", \"electricity\", \"water\", \"gas\"])).optional(),\n        assets: z\n          .array(\n            z.object({\n              id: z.string(),\n              label: z.string(),\n              category: z.enum([\"appliance\", \"electronics\", \"vehicle\", \"furniture\", \"other\"]),\n              serial: z.string().optional(),\n              warrantyEnd: z.string().nullable(),\n            })\n          )\n          .optional(),\n      })\n      .optional(),\n    finance: z\n      .object({\n        currency: z.string().default(\"CAD\"),\n        income: z.array(\n          z.object({\n            name: z.string(),\n            amount: z.number(),\n            frequency: z.enum([\"weekly\", \"biweekly\", \"monthly\"]),\n            nextDate: z.string(),\n          })\n        ),\n        bills: z.array(\n          z.object({\n            name: z.string(),\n            amount: z.number(),\n            dueDay: z.number(),\n            autopay: z.boolean().default(false),\n            tag: z.string().optional(),\n          })\n        ),\n        budgetTemplate: z\n          .array(\n            z.object({\n              category: z.string(),\n              percent: z.number(),\n            })\n          )\n          .optional(),\n      })\n      .optional(),\n    care: z\n      .array(\n        z.object({\n          name: z.string(),\n          relation: z.string(),\n          meds: z.array(\n            z.object({\n              name: z.string(),\n              strengthMg: z.number().optional(),\n              schedule: ScheduleSchema,\n              unitsPerDose: z.number(),\n              pillsOnHand: z.number().optional(),\n              lowStockDays: z.number().default(7),\n            })\n          ),\n        })\n      )\n      .optional(),\n    rules: z\n      .array(\n        z.object({\n          id: z.string(),\n          trigger: z.string(),\n          action: z.string(),\n        })\n      )\n      .optional(),\n    goals: z\n      .array(\n        z.object({\n          name: z.string(),\n          target: z.number(),\n          deadline: z.string().optional(),\n          priority: z.number().min(1).max(5),\n        })\n      )\n      .optional(),\n  }),\n});\n\nexport type Setup = z.infer<typeof SetupSchema>;\nexport type StepKey = keyof Setup[\"steps\"];\nexport type SetupData = Setup[\"data\"];\n\nexport const StepOrder: StepKey[] = [\n  \"accounts\",\n  \"people\",\n  \"documents\",\n  \"household\",\n  \"finance\",\n  \"health\",\n  \"automations\",\n  \"goals\",\n];\n\nexport type PreviewResponse = {\n  finance?: {\n    forecast: number[];\n    bills: Array<{ name: string; due: string; amount: number }>;\n  };\n  care?: Array<{ person: string; nextDose: string }>;\n  rules?: Array<{ id: string; count: number }>;\n  readiness: number;\n};\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 230, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/onboarding/serverState.ts"],"sourcesContent":["import { Setup, StepKey, StepOrder } from \"./validators\";\n\nconst defaultSetup: Setup = {\n  version: 1,\n  progress: 0,\n  steps: {\n    accounts: false,\n    people: false,\n    documents: false,\n    household: false,\n    finance: false,\n    health: false,\n    automations: false,\n    goals: false,\n  },\n  data: {\n    integrations: {},\n  },\n};\n\ndeclare global {\n  // eslint-disable-next-line no-var\n  var __ONBOARDING_STATE__: Setup | undefined;\n}\n\nexport function getServerSetup(): Setup {\n  if (!globalThis.__ONBOARDING_STATE__) {\n    globalThis.__ONBOARDING_STATE__ = structuredClone(defaultSetup);\n  }\n  return globalThis.__ONBOARDING_STATE__ as Setup;\n}\n\nexport function setServerSetup(next: Setup): Setup {\n  globalThis.__ONBOARDING_STATE__ = structuredClone(next);\n  return getServerSetup();\n}\n\nexport function markStep(step: StepKey, completed: boolean): Setup {\n  const current = getServerSetup();\n  current.steps[step] = completed;\n  current.progress = computeProgress(current.steps);\n  return setServerSetup(current);\n}\n\nexport function computeProgress(steps: Setup[\"steps\"]): number {\n  const total = StepOrder.length;\n  const completed = StepOrder.filter((step) => steps[step]).length;\n  return Math.round((completed / total) * 100);\n}\n\nexport function mergeSetup(partial: Partial<Setup>): Setup {\n  const current = getServerSetup();\n  const merged: Setup = {\n    ...current,\n    ...partial,\n    steps: { ...current.steps, ...partial.steps },\n    data: { ...current.data, ...partial.data },\n  };\n  merged.progress = computeProgress(merged.steps);\n  return setServerSetup(merged);\n}\n"],"names":[],"mappings":";;;;;;;AAAA;;AAEA,MAAM,eAAsB;IAC1B,SAAS;IACT,UAAU;IACV,OAAO;QACL,UAAU;QACV,QAAQ;QACR,WAAW;QACX,WAAW;QACX,SAAS;QACT,QAAQ;QACR,aAAa;QACb,OAAO;IACT;IACA,MAAM;QACJ,cAAc,CAAC;IACjB;AACF;AAOO,SAAS;IACd,IAAI,CAAC,WAAW,oBAAoB,EAAE;QACpC,WAAW,oBAAoB,GAAG,gBAAgB;IACpD;IACA,OAAO,WAAW,oBAAoB;AACxC;AAEO,SAAS,eAAe,IAAW;IACxC,WAAW,oBAAoB,GAAG,gBAAgB;IAClD,OAAO;AACT;AAEO,SAAS,SAAS,IAAa,EAAE,SAAkB;IACxD,MAAM,UAAU;IAChB,QAAQ,KAAK,CAAC,KAAK,GAAG;IACtB,QAAQ,QAAQ,GAAG,gBAAgB,QAAQ,KAAK;IAChD,OAAO,eAAe;AACxB;AAEO,SAAS,gBAAgB,KAAqB;IACnD,MAAM,QAAQ,wIAAA,CAAA,YAAS,CAAC,MAAM;IAC9B,MAAM,YAAY,wIAAA,CAAA,YAAS,CAAC,MAAM,CAAC,CAAC,OAAS,KAAK,CAAC,KAAK,EAAE,MAAM;IAChE,OAAO,KAAK,KAAK,CAAC,AAAC,YAAY,QAAS;AAC1C;AAEO,SAAS,WAAW,OAAuB;IAChD,MAAM,UAAU;IAChB,MAAM,SAAgB;QACpB,GAAG,OAAO;QACV,GAAG,OAAO;QACV,OAAO;YAAE,GAAG,QAAQ,KAAK;YAAE,GAAG,QAAQ,KAAK;QAAC;QAC5C,MAAM;YAAE,GAAG,QAAQ,IAAI;YAAE,GAAG,QAAQ,IAAI;QAAC;IAC3C;IACA,OAAO,QAAQ,GAAG,gBAAgB,OAAO,KAAK;IAC9C,OAAO,eAAe;AACxB","debugId":null}},
    {"offset": {"line": 300, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/api/onboarding/detect/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport { mergeSetup, getServerSetup, computeProgress } from \"@/lib/onboarding/serverState\";\nimport { StepKey, StepOrder, Setup } from \"@/lib/onboarding/validators\";\nimport { DetectResponse } from \"@/lib/onboarding/types\";\n\nfunction determineMissing(setup: Setup): StepKey[] {\n  return StepOrder.filter((step) => !setup.steps[step]);\n}\n\nfunction buildProgressByStep(setup: Setup): Record<StepKey, number> {\n  return StepOrder.reduce((acc, step) => {\n    acc[step] = setup.steps[step] ? 100 : 0;\n    return acc;\n  }, {} as Record<StepKey, number>);\n}\n\nexport async function POST(req: Request) {\n  const body = await req.json().catch(() => ({}));\n  const incoming = body?.setup as Partial<Setup> | undefined;\n  const setup = incoming ? mergeSetup(incoming) : getServerSetup();\n  const response: DetectResponse = {\n    missing: determineMissing(setup),\n    progressByStep: buildProgressByStep(setup),\n    setup: { ...setup, progress: computeProgress(setup.steps) },\n  };\n  return NextResponse.json(response);\n}\n"],"names":[],"mappings":";;;AAAA;AACA;AACA;;;;AAGA,SAAS,iBAAiB,KAAY;IACpC,OAAO,wIAAA,CAAA,YAAS,CAAC,MAAM,CAAC,CAAC,OAAS,CAAC,MAAM,KAAK,CAAC,KAAK;AACtD;AAEA,SAAS,oBAAoB,KAAY;IACvC,OAAO,wIAAA,CAAA,YAAS,CAAC,MAAM,CAAC,CAAC,KAAK;QAC5B,GAAG,CAAC,KAAK,GAAG,MAAM,KAAK,CAAC,KAAK,GAAG,MAAM;QACtC,OAAO;IACT,GAAG,CAAC;AACN;AAEO,eAAe,KAAK,GAAY;IACrC,MAAM,OAAO,MAAM,IAAI,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;IAC7C,MAAM,WAAW,MAAM;IACvB,MAAM,QAAQ,WAAW,CAAA,GAAA,yIAAA,CAAA,aAAU,AAAD,EAAE,YAAY,CAAA,GAAA,yIAAA,CAAA,iBAAc,AAAD;IAC7D,MAAM,WAA2B;QAC/B,SAAS,iBAAiB;QAC1B,gBAAgB,oBAAoB;QACpC,OAAO;YAAE,GAAG,KAAK;YAAE,UAAU,CAAA,GAAA,yIAAA,CAAA,kBAAe,AAAD,EAAE,MAAM,KAAK;QAAE;IAC5D;IACA,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;AAC3B","debugId":null}}]
}